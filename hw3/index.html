<!DOCTYPE html>
<html lang="en"  class="theme--light" >

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/apple-touch-icon-57x57.png" />
  <link rel="short icon" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
  <title> â€¢ Homework 3: Pathtracer</title>
  
  
  
</head>

<body>
  <div id="sidebar" class="animated fadeInDown">
    <div class="logo-title">
      <div class="title">
        <img src=https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/images/mirror_cloth.png style="width:80%;" alt="logo" />
        <h3><a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/"></a></h3>
        <div class="description">
          <p></p>
        </div>
      </div>
    </div>
    <ul class="social-links">
      
    </ul>
    <div class="footer">
      
      <span>Designed by </span><a href="https://www.caicai.me">CaiCai</a>
      <div class="by_zola"><a href="https://www.getzola.org/" target="_blank">Proudly published with Zola!</a></div>
      
    </div>
  </div>
  <div id="main">
    <div class="page-top animated fadeInDown">
      <div class="nav">
        
        
        
        
        <li><a  href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/">Home</a></li>
        <li><a  href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw1/">Homework 1</a></li>
        <li><a  href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw2/">Homework 2</a></li>
        <li><a class="current"  href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/">Homework 3</a></li>
        <li><a  href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw4/">Homework 4</a></li>
      </div>
      <div class="information">
        <div class="back_btn">
          <a onclick="window.history.go(-1)" ><i
              class="fas fa-chevron-left"></i></a>
        </div>
        
        
        
      </div>
    </div>
    <div class="autopagerize_page_element">
      <div class="content">
        
<article class="post animated fadeInDown">
  <h1><a href="https:&#x2F;&#x2F;cal-cs184-student.github.io&#x2F;hw-webpages-sp24-lethalNeutrino&#x2F;hw3&#x2F;">Homework 3: Pathtracer</a></h1>
  
  <div class="post-content"><h1 id="table-of-contents">Table of Contents</h1>
<h2 id="task-1-ray-generation">Task 1: <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/task1">Ray Generation</a></h2>
<h2 id="task-2-bounding-volume-hierarchy">Task 2: <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/task2">Bounding Volume Hierarchy</a></h2>
<h2 id="task-3-direct-lighting">Task 3: <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/task3">Direct Lighting</a></h2>
<h2 id="task-4-global-lighting">Task 4: <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/task4">Global Lighting</a></h2>
<h2 id="task-5-adaptive-sampling">Task 5: <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/task5">Adaptive Sampling</a></h2>
<h2 id="introduction">Introduction</h2>
<p>This project was about implementing raytraced rendering of scenes.
We started by getting the camera to <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task1">generate random rays</a> out into the scene through specific pixels, which we then checked to see if they intersected anything in the scene.
In particular, we had to implement <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task1">intersection finding</a> for the triangle and sphere primitives. 
If we find an intersection, then we can add the color we think the material should be (our <em>estimate of the global illumination</em> of that point) to our average color for that pixel, otherwise we don't add anything to the color.
Then, we optimized our intersection algorithm by implementing a <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task2">bounding volume hierarchy</a> (BVH), which consisted of putting our primitives in groups and then putting them inside bounding boxes; if a ray misses the bounding box, it will miss all the primitives in the scene, allowing us to cut down substantially on intersection checks.</p>
<p>Then, we implemented the real ray tracing part: we followed the path of rays into the scene, and updated the light they received if we either hit a light source (which just emitted its light directly into the camera), or hit an object which had light cast directly onto it. 
This is called <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task3">direct illumination</a>.
Handling objects with light cast onto them was a little difficult, and involved two different methods: <em>uniform hemisphere sampling</em> and <em>importance sampling by lights</em>, which we discuss in more detail in <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task3">Task 3</a>.
We then upgraded this ray tracing to handle multiple bounces of light in the scene (<a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task4">global illumination</a>), which improved the visual quality and, you know, lit up the ceiling.
Finally, we went back and optimized our pixel sampling; sometimes, we don't need to sample that many times per pixel because the result we get back is almost exactly the same every time. 
So, we can <a href="https://cal-cs184-student.github.io/hw-webpages-sp24-lethalNeutrino/hw3/./task5">adapt our sampling strategy</a> to avoid doing a lot of extra work in places where it doesn't make much of a difference. </p>
<h3 id="debugging-woes">Debugging woes</h3>
<p>We ran into a pretty large number of bugs in this project.
When implementing task 3, we ran into an unexplainable bug where at most 10-20 rays would hit a light and update the corresponding pixel, even in an empty room, leaving the room basically completely dark.
We tried every fix under the sun until we realized that the bug was caused by broken task 2 code.
The issue was that bounding box intersections didn't work properly when the ray started <em>inside</em> the bounding box itself.
This was fine when we were just rendering the scene to a file, because we always start the camera outside of any bounding boxes.
However, when rays needed to suddenly bounce off of objects in the scene in task 3, everything just broke.
Only when rays magically originated outside of the bounding box of the object they hit (through cursed floating point arithmetic) were they getting a chance to intersect things properly at all, which (along with the low probability of pointing in the right direction in the first place when it came to hemisphere sampling) was what caused the 10-20 ray phenomenon earlier. </p>
<p>There was another medium-sized bug that we didn't catch for quite some time, because I (Aditya) was not looking at the output images very carefully.
After finishing task 4 (yes, it took me that long to realize), I finally realized that there were no shadows in any of the importance sampling renders.
The problem was simple: the code never checked that light could actually reach the point that it intersected, so no shadow rays were ever cast and the light just teleported through objects.
An easy fix, but one that took a baffling amount of time.</p>
<p>Also after finishing task 4, we noticed that our outputs were kind of grainy when compared to staff renders: not significant, but enough to be noticeable.
Part of the issue was that Russian Roulette continuation probabilities were being applied to the first indirect bounce, unlike what the spec says, which leads to any indirect lighting being much more grainy overall.
But this wasn't the whole story: the lighting was still slightly grainy after this too. 
Honestly, we're not sure we even fully fixed this, but our best guess was that this was caused by using a different (smaller) epsilon in our bounding box intersection than provided by the code, and this was leading to more rays disappearing... somehow? 
Changing the epsilon to <code>EPS_F</code> appeared to help, but we're not 100% sure why. 
After that point, we weren't sure if we were still detecting more graininess than staff, or we were just seeing things that weren't there, so we moved on. </p>
<p>When implementing Task 5, we were really mystified by somehow indexing fractionally into our array... until we realized we accidentally shadowed the <code>x</code> variable <code>;-;</code>. For task 2, we ran into some weird bugs based on not pruning the nodes properly, and this was because of our un-implemented <code>Triangle-&gt;has_intersection()</code> algorithm. Once we fixed this, we got the speedup we desired.</p>
<h3 id="reflection">Reflection</h3>
<p>Overall, this project was really, really fun. 
The feeling of getting everything to work right and being rewarded with a beautiful render was really amazing, no matter how many times it happened.
More seriously, applying all of the lighting and raytracing concepts we learned in lecture was both enlightening (no pun intended) and enjoyable. 
I (Aditya) feel like I learned a lot of new information from this project, and it solidified my understanding in other places. 
When it comes to our workflow, well, we probably should have started in earnest a little sooner. 
But working together was pretty equitable overall; we didn't have much time to meet up, so we generally split tasks up and finished them individually, helping each other through bugs when they came up.</p>
<p>I (Andrew) feel like this project really helped me learn a lot about ray tracing since I've seen a lot of videos and lectures on the subject, but I haven't tried to actually implement it. The most satisfying moment for the entire project was seeing the BVH implementation actually work. When we rendered the cow in 0.14 seconds, I was really happy. I was even happier to see Max Planck get rendered in 0.13 seconds... until Max turned into swiss cheese because of incorrect pruning logic. Once we fixed that though... rendering Max in 0.17 seconds correctly was super satisfying.</p>
</div>
  <div class="post-footer">
    <div class="meta">
      <div class="info">
        
        <i class="far fa-sun"></i><span class="date">2024-03-12</span>
        
        
      </div>
    </div>
  </div>
</article>
<div class="share">
  <div class="weibo">
    <a class="fab fa-weibo"
      href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&title=',e(d.title),'&appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a>
  </div>
  <div class="twitter">
    <a class="fab fa-twitter"
      href="http://twitter.com/share?text=Homework 3: Pathtracer&url=https:&#x2F;&#x2F;cal-cs184-student.github.io&#x2F;hw-webpages-sp24-lethalNeutrino&#x2F;hw3&#x2F;"></a>
  </div>
</div>







<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['$$', '$$'], ["\\[", "\\]"]],
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>




      </div>
    </div>
  </div>
  
  <script>
    function showLanguages() {
      let currentDisplay = document.getElementById("languages").style.display;
      if (currentDisplay == 'none') {
        document.getElementById("languages").style.display = 'block';
      } else {
        document.getElementById("languages").style.display = 'none';
      }
    }
  </script>
</body>

</html>
